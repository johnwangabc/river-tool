# 快速开始指南

## 一、安装环境

### 1. 安装 Node.js
- 访问 https://nodejs.org/
- 下载并安装 LTS 版本 (16.x 或更高)

### 2. 安装 Expo CLI 和 EAS CLI
```bash
npm install -g expo-cli eas-cli
```

## 二、安装项目依赖

在项目目录中运行：
```bash
npm install
```

## 三、本地测试运行

### 方法1: 使用Expo Go应用 (推荐)

1. 在手机上安装 Expo Go 应用
   - Android: Google Play 或应用商店搜索 "Expo Go"
   - iOS: App Store 搜索 "Expo Go"

2. 启动开发服务器
```bash
npm start
```

3. 扫描终端显示的二维码
   - Android: 使用 Expo Go 应用内的扫描功能
   - iOS: 使用相机应用扫描，然后在 Expo Go 中打开

### 方法2: 使用Android模拟器

```bash
npm run android
```

### 方法3: 使用iOS模拟器 (仅macOS)

```bash
npm run ios
```

## 四、Expo云打包 (生成独立APK)

### 1. 创建Expo账号
- 访问 https://expo.dev/
- 注册账号并登录

### 2. 登录EAS
```bash
eas login
```

### 3. 初始化项目
```bash
eas project:init
```
这会生成一个项目ID并更新 `app.json`

### 4. 构建Android APK (用于测试和分发)
```bash
eas build --platform android --profile preview
```

### 5. 构建生产版本 (用于发布)
```bash
eas build --platform android --profile production
```

### 6. 下载APK
- 构建完成后，会显示一个下载链接
- 也可以在 https://expo.dev/accounts/[your-username]/projects/river-patrol-stats/builds 查看所有构建

## 五、应用使用

### 首次配置

1. 打开应用后，先进入"设置"页面
2. 输入认证Token:
   - 打开浏览器访问 https://xhbr.rwan.org.cn
   - 登录后按F12打开开发者工具
   - 切换到Network标签
   - 刷新页面或执行操作
   - 在请求头中找到 `Authorization` 字段
   - 复制完整值 (格式: Bearer eyJ0eXAiOi...)
   - 粘贴到应用的Token输入框

3. 点击"保存设置"

### 使用功能

**活动统计**:
- 进入"活动统计"页面
- 输入目标日期 (如: 2025-01-01)
- 点击"开始统计"
- 查看数据或导出Excel

**巡护/评测**:
- 进入"巡护评测"页面
- 选择数据类型
- 输入开始日期
- 点击"开始爬取"

**综合统计**:
- 进入"综合统计"页面
- 输入开始日期
- 点击"开始统计" (需要较长时间)

## 六、常见问题

### Q: Token在哪里获取？
A: 在浏览器中登录系统后，从开发者工具的Network标签中查看请求头的Authorization字段。

### Q: 如何生成APK文件？
A: 使用 `eas build --platform android --profile preview` 命令，构建完成后会得到下载链接。

### Q: 导出的Excel在哪里？
A: 点击导出后会弹出分享对话框，可以选择保存位置或通过其他应用分享。

### Q: 数据加载很慢怎么办？
A: 这是正常现象，因为需要请求大量数据。建议使用WiFi网络，并耐心等待。

### Q: 提示Token过期？
A: 重新从浏览器获取新的Token，并在设置中更新。

## 七、项目结构简介

```
new/
├── App.js                    # 主应用入口
├── package.json              # 依赖配置
├── app.json                  # Expo配置
├── eas.json                  # 云打包配置
├── src/
│   ├── screens/             # 页面组件
│   │   ├── SettingsScreen.js      # 设置
│   │   ├── ActivityScreen.js      # 活动统计
│   │   ├── RiverPatrolScreen.js   # 巡护/评测
│   │   └── ComprehensiveScreen.js # 综合统计
│   ├── components/          # 通用组件
│   │   └── DataTable.js           # 表格组件
│   └── utils/              # 工具函数
│       ├── storage.js             # 本地存储
│       ├── apiClient.js           # API请求
│       ├── dataProcessor.js       # 数据处理
│       └── excelExporter.js       # Excel导出
└── README.md               # 详细文档
```

## 八、技术支持

如遇到问题：
1. 查看 README.md 中的详细文档
2. 检查网络连接和Token配置
3. 查看应用内的进度提示信息
4. 联系开发团队

---

祝使用愉快！
