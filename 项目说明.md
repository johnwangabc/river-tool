# 巡河宝统计工具 - React Native移动端版本

## 项目概述

本项目是将原有的Python桌面版巡河宝统计工具完整移植到React Native移动端的版本。使用Expo框架开发，支持Android和iOS平台。

## 核心功能对照

| 功能模块 | Python桌面版 | React Native移动版 | 状态 |
|---------|------------|------------------|-----|
| 活动数据统计 | Tab 1 | ActivityScreen | ✅ 完成 |
| 河流评测数据 | Tab 2 | RiverPatrolScreen (useType=2) | ✅ 完成 |
| 河流巡护数据 | Tab 3 | RiverPatrolScreen (useType=1) | ✅ 完成 |
| 综合次数统计 | Tab 4 | ComprehensiveScreen | ✅ 完成 |
| Token配置 | config.ini | SettingsScreen | ✅ 完成 |
| Excel导出 | pandas + openpyxl | xlsx + expo-sharing | ✅ 完成 |
| 数据展示 | Tkinter表格 | React Native Paper表格 | ✅ 完成 |

## 技术架构对比

### Python桌面版
- **UI框架**: Tkinter
- **网络请求**: requests
- **数据处理**: pandas
- **Excel导出**: openpyxl
- **配置管理**: config.ini文件
- **平台**: Windows桌面

### React Native移动版
- **UI框架**: React Native + React Native Paper
- **网络请求**: Axios
- **数据处理**: JavaScript原生 + date-fns
- **Excel导出**: SheetJS (xlsx)
- **配置管理**: AsyncStorage
- **平台**: Android + iOS

## 项目文件结构

```
new/
├── 原Python文件
│   ├── 巡河宝统计工具.py        # 原桌面版主程序
│   ├── config.py                 # 原配置模块
│   ├── api_client.py            # 原API客户端
│   ├── data_processor.py        # 原数据处理
│   └── ...其他Python模块
│
├── React Native项目
│   ├── App.js                   # RN主入口 (对应原main函数)
│   ├── package.json             # 依赖配置
│   ├── app.json                 # Expo配置
│   ├── eas.json                 # 云打包配置
│   │
│   ├── src/
│   │   ├── screens/            # 对应原Tkinter的4个Tab
│   │   │   ├── SettingsScreen.js       # 对应config.ini管理
│   │   │   ├── ActivityScreen.js       # 对应ActivityAnalyzer
│   │   │   ├── RiverPatrolScreen.js    # 对应RiverPatrolCrawler
│   │   │   └── ComprehensiveScreen.js  # 对应综合统计Tab
│   │   │
│   │   ├── components/
│   │   │   └── DataTable.js           # 数据表格展示组件
│   │   │
│   │   └── utils/
│   │       ├── storage.js             # 对应config.ini
│   │       ├── apiClient.js           # 对应原api_client.py
│   │       ├── dataProcessor.js       # 对应原data_processor.py
│   │       └── excelExporter.js       # 对应原Excel导出功能
│   │
│   └── assets/                  # 应用图标和资源
│
└── 文档
    ├── README.md                # 完整文档
    ├── 快速开始.md               # 快速入门指南
    └── 项目说明.md               # 本文件
```

## 功能实现细节

### 1. 活动数据统计 (ActivityScreen)
**对应原功能**: `ActivityAnalyzer` 类

**实现的方法**:
- ✅ `get_limited_activities()` → `api.getActivities()`
- ✅ `get_activity_detail()` → `api.getActivityDetail()`
- ✅ `filter_activities_by_date()` → `dataProcessor.filterActivitiesByDate()`
- ✅ `export_activities_to_excel()` → `excelExporter.exportActivities()`
- ✅ `analyze_participants()` → `dataProcessor.analyzeParticipants()`

**新增功能**:
- ✅ 表格形式展示数据
- ✅ 统计摘要Chip展示
- ✅ 实时进度提示

### 2. 河流巡护/评测 (RiverPatrolScreen)
**对应原功能**: `RiverPatrolCrawler` 类

**实现的方法**:
- ✅ `crawl_all_data()` → `api.getAllRiverPatrolData()`
- ✅ `process_user_data()` → `dataProcessor.processRiverPatrolUserData()`
- ✅ `save_to_excel()` → `excelExporter.exportRiverPatrol()`

**新增功能**:
- ✅ 统一界面切换 useType (1/2)
- ✅ 数据预览 (前50条)
- ✅ 实时爬取进度显示

### 3. 综合次数统计 (ComprehensiveScreen)
**对应原功能**: Tab 4 综合统计

**实现的方法**:
- ✅ 并行获取3种数据源
- ✅ 统计合并 → `dataProcessor.calculateComprehensiveStats()`
- ✅ 按总次数排序
- ✅ Excel导出

**新增功能**:
- ✅ 简化的数据展示
- ✅ 进度实时更新
- ✅ 错误容忍处理

### 4. 设置管理 (SettingsScreen)
**对应原功能**: `config.ini` + `config.py`

**实现的功能**:
- ✅ Token存储和管理
- ✅ 组织ID配置
- ✅ 持久化存储 (AsyncStorage)
- ✅ 清除设置功能

**改进**:
- ✅ 用户友好的输入界面
- ✅ 使用说明集成在界面中
- ✅ 即时保存验证

## 使用流程

### 快速上手 (3步)

1. **安装依赖**
```bash
npm install
```

2. **本地运行**
```bash
npm start
# 用Expo Go扫码即可在手机上查看
```

3. **云打包APK**
```bash
eas login
eas build --platform android --profile preview
```

### 完整部署流程

详见 `快速开始.md` 文档。

## API端点 (与原版保持一致)

| 端点 | 用途 | 对应原函数 |
|-----|------|----------|
| `/portal/ums/active/home/list` | 活动列表 | `get_limited_activities()` |
| `/portal/ums/active/info/{id}` | 活动详情 | `get_activity_detail()` |
| `/portal/ums/patrol/home/list_new` | 巡护/评测数据 | `crawl_all_data()` |

基础URL: `https://xhbr.rwan.org.cn/prod-api`

## 数据处理逻辑

### 1. 日期过滤
```javascript
// 对应原版的 filter_activities_by_date()
filterActivitiesByDate(activities, targetDateStr)
```

### 2. 用户数据聚合
```javascript
// 对应原版的 process_user_data()
processRiverPatrolUserData(data)
```

### 3. 参与者分析
```javascript
// 对应原版的 analyze_participants()
analyzeParticipants(activitiesData)
```

### 4. 综合统计
```javascript
// 对应原版Tab4的统计逻辑
calculateComprehensiveStats(patrolData, evaluationData, participantsData)
```

## Excel导出格式 (与原版一致)

### 活动数据
- 活动基本信息表
- 活动统计表

### 参与者统计
- 参与者统计表
- 活动详情表
- 活动统计表

### 河流巡护/评测
- 用户发帖统计表
- 数据概览表

### 综合统计
- 综合次数统计表
- 统计摘要表

## 与原版的主要区别

### 优势

1. **跨平台**: 支持Android和iOS
2. **移动优先**: 适配移动端交互体验
3. **云打包**: 使用Expo云服务，无需本地Android/iOS环境
4. **实时反馈**: 更流畅的进度提示
5. **现代UI**: 使用Material Design风格

### 限制

1. **图表功能**: 暂未实现原版的matplotlib图表功能
2. **文件管理**: 移动端文件管理方式不同，需要通过分享保存
3. **日志系统**: 简化了原版的logger模块

## 依赖包说明

| 原Python包 | React Native对应包 | 用途 |
|-----------|------------------|-----|
| tkinter | react-native-paper | UI组件 |
| requests | axios | HTTP请求 |
| pandas | 原生JavaScript | 数据处理 |
| openpyxl | xlsx (SheetJS) | Excel操作 |
| - | AsyncStorage | 配置存储 |
| - | expo-file-system | 文件管理 |
| - | expo-sharing | 文件分享 |
| datetime | date-fns | 日期处理 |

## 测试和调试

### 本地测试
```bash
npm start
```
在Expo Go中扫码测试

### 生成测试APK
```bash
eas build --platform android --profile preview
```

### 生产版本
```bash
eas build --platform android --profile production
```

## 后续优化建议

1. **性能优化**
   - 添加数据缓存机制
   - 实现增量加载
   - 优化大数据量渲染

2. **功能扩展**
   - 添加图表展示 (使用react-native-chart-kit)
   - 支持历史查询记录
   - 添加数据对比功能

3. **用户体验**
   - 添加离线模式
   - 优化错误提示
   - 增加数据预览分页

4. **代码质量**
   - 添加TypeScript类型
   - 编写单元测试
   - 添加错误监控

## 常见问题

### Q: 为什么选择Expo而不是纯React Native?
A: Expo提供了云打包服务，无需配置复杂的Android/iOS开发环境，简化了开发和分发流程。

### Q: 能否运行在Web上?
A: 可以，运行 `npm run web` 即可，但Excel导出功能在Web上可能需要调整。

### Q: 如何更新app.json中的projectId?
A: 运行 `eas project:init` 会自动生成并更新。

### Q: Token存储安全吗?
A: 使用AsyncStorage存储在设备本地，相对安全。如需更高安全性，可以考虑使用expo-secure-store。

## 联系和支持

- 项目文档: 见 `README.md`
- 快速入门: 见 `快速开始.md`
- 原Python版本: `巡河宝统计工具.py`

---

**版本**: v1.0.0
**创建日期**: 2025年
**开发框架**: React Native + Expo
**目标平台**: Android, iOS
