# 河流数据统计工具 - EXE打包说明

## 📦 打包方式

### 方法一：使用自动化脚本（推荐）

```bash
python build_exe.py
```

这个脚本会自动:
1. 备份原配置文件
2. 使用EXE专用配置（config_exe.py）
3. 安装PyInstaller（如果未安装）
4. 执行打包
5. 恢复原配置
6. 复制配置文件到dist目录

### 方法二：手动打包

1. **准备配置**
   ```bash
   # 备份原配置
   copy config.py config.py.backup

   # 使用EXE版配置
   copy config_exe.py config.py
   ```

2. **安装PyInstaller**
   ```bash
   pip install pyinstaller
   ```

3. **执行打包**
   ```bash
   pyinstaller 巡河宝统计工具.spec
   ```

4. **恢复配置**
   ```bash
   move config.py.backup config.py
   ```

5. **复制配置文件**
   ```bash
   copy user_config.ini dist\user_config.ini
   ```

## 📂 打包后的文件结构

```
dist/
├── 巡河宝统计工具.exe    # 主程序（约50MB）
└── user_config.ini        # 用户配置文件（只包含token）
```

## 🚀 分发和使用

### 分发给用户

1. 将整个 `dist` 文件夹压缩
2. 分发给用户
3. 告知用户：
   - 解压到任意位置
   - 编辑 `user_config.ini`，填入token
   - 双击运行 `巡河宝统计工具.exe`

### user_config.ini 配置示例

```ini
[API]
# 认证令牌配置
# 格式: Bearer eyJ0eXAiOiJKV1QiLCJhbGci...
# 如果token过期，请在此处更新
auth_token = Bearer YOUR_ACTUAL_TOKEN_HERE
```

## 🔒 安全说明

### 已隐藏的配置项

以下配置已内置在程序中，**不会**暴露给用户：

- ✅ API地址（base_url）
- ✅ 组织ID（org_id）
- ✅ 爬虫参数（max_pages, page_size等）
- ✅ 并发设置
- ✅ 超时时间
- ✅ SSL验证设置
- ✅ 所有其他技术参数

### 用户可配置项

用户**只能**配置：
- ✅ 认证令牌（auth_token）

## 🛠️ config_exe.py vs config.py

| 特性 | config.py（开发版） | config_exe.py（EXE版） |
|------|-------------------|---------------------|
| 配置来源 | config.ini文件 | 硬编码在代码中 |
| 用户可修改 | 所有配置 | 只有token |
| 适用场景 | 开发调试 | 打包分发 |
| 安全性 | 低（暴露所有参数） | 高（隐藏技术细节） |

## 📋 完整打包清单

打包前确保这些文件存在：

- [x] `巡河宝统计工具.py` - 主程序
- [x] `config_exe.py` - EXE专用配置模块
- [x] `logger.py` - 日志模块
- [x] `api_client.py` - API客户端
- [x] `data_processor.py` - 数据处理
- [x] `exceptions.py` - 异常定义
- [x] `user_config.ini` - 用户配置文件
- [x] `巡河宝统计工具.spec` - PyInstaller配置
- [x] `build_exe.py` - 自动打包脚本

## ⚠️ 常见问题

### Q1: 打包后提示"认证令牌未配置"

A: 确保 `user_config.ini` 与 exe 文件在同一目录，并且已正确填写token。

### Q2: 打包后程序无法启动

A:
1. 检查是否安装了所有依赖包
2. 使用命令行运行exe查看错误信息
3. 检查 `logs` 目录中的日志文件

### Q3: 如何更新token？

A: 直接编辑 exe 同目录下的 `user_config.ini` 文件即可，无需重新打包。

### Q4: 打包文件太大

A: 单文件打包约50MB是正常的，包含了Python解释器和所有依赖。
如需减小体积，可以：
- 使用 `--onedir` 模式（但会生成多个文件）
- 移除不需要的matplotlib等大型库

### Q5: 如何添加程序图标？

A: 在 `巡河宝统计工具.spec` 文件中，修改这一行：
```python
icon='your_icon.ico',  # 指定图标文件路径
```

## 📝 重新打包

如果需要重新打包（例如修改了代码）：

1. 删除构建缓存：
   ```bash
   rmdir /s /q build
   rmdir /s /q dist
   del /q *.spec
   ```

2. 重新运行打包脚本：
   ```bash
   python build_exe.py
   ```

## 🎯 验证打包

打包完成后，测试步骤：

1. 进入 `dist` 目录
2. 编辑 `user_config.ini`，填入测试token
3. 双击运行 `巡河宝统计工具.exe`
4. 测试各个功能是否正常
5. 检查是否能正确生成Excel文件
6. 验证日志是否正常记录

## 🔄 版本更新流程

1. 修改源代码
2. 测试功能
3. 运行打包脚本
4. 测试打包后的exe
5. 更新版本号（可选）
6. 分发新版本

---

**最后更新**: 2025-11-01
**打包工具**: PyInstaller
**Python版本**: 3.7+
